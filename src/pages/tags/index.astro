---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

const posts = await getCollection("blog");

// Get all unique tags with their counts
const tagCounts = posts.reduce(
  (acc, post) => {
    const tags = post.data.tags || [];
    tags.forEach((tag) => {
      acc[tag] = (acc[tag] || 0) + 1;
    });
    return acc;
  },
  {} as Record<string, number>
);

const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="Tags">
  <h1 class="mb-8">Tags</h1>

  <div class="flex flex-wrap gap-3">
    {
      sortedTags.map(([tag, count]) => (
        <a
          class="block-bg block-hover rounded-full px-4 py-2 text-lg"
          href={`/tags/${tag}`}
        >
          #{tag}
          <span class="ml-1 text-sm opacity-60">({count})</span>
        </a>
      ))
    }
  </div>

  {
    sortedTags.length === 0 && (
      <p class="opacity-60">No tags found. Add tags to your blog posts!</p>
    )
  }
</BaseLayout>
